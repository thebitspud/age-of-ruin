let addHeader=function(e){return`<p class="header">${e}</p><hr class="header">`},addButton=function(e,t){return`<button class="option" onclick="${e}">${t}</button>`},addIDButton=function(e,t,n){return`<button id="${e}" class="option" onclick="${t}">${n}</button>`};function setOptions(e){$("#options").empty().append(e)}$(function(){displayPlayer(),displayInventory(),$("#quests").append(addHeader("QUESTS")),$("#inspect").append(addHeader("INSPECT")),addEventPack(evts_intro),addEventPack(evts_forest),addEventPack(evts_road),addEventPack(evts_obelisk),addEventPack(evts_vision),addEventPack(evts_mountain),playEvent("intro-0")});const player={health:{max:100,now:100},energy:{max:100,now:100},weight:{max:25,now:0},def:0,primary:"None",secondary:"None"};function healPlayer(e){player.health.now+=e,player.health.now>player.health.max&&(player.health.now=player.health.max)}function displayPlayer(){$player=$("#player"),$player.empty().append(addHeader("PLAYER")).append(`Health : ${player.health.now} / ${player.health.max}`).append(`<br>Energy : ${player.energy.now} / ${player.energy.max}`).append(`<br>Weight : ${player.weight.now} / ${player.weight.max}`),"None"===player.primary?$player.append("<br><br>Primary : None"):$player.append(`<br><br>Primary : ${itemLink(player.primary)}`),"None"===player.secondary?$player.append("<br>Secondary : None"):$player.append(`<br>Secondary : ${itemLink(player.secondary)}`)}const items={berries:{type:"consumable",name:"Berries",weight:2,desc:"A fistful of edible berries that can be eaten to restore some health.",effect:"+10 HP",use:function(){healPlayer(10)}},"blunt-dagger":{type:"weapon",name:"Blunt Dagger",weight:3,desc:"A worn but functional dagger with a dull blade. It would be more useful if sharpened.",atk_dmg:6,atk_rate:1,size:"secondary"},error:{type:"debug",name:"Missing Item",weight:0,desc:"That item could not be accessed. Please report this issue to <a href='https://github.com/thebitspud/age-of-ruin/issues' target='_blank' rel='noopener'>the developer</a>."},"filthy-cloth":{type:"artifact",name:"Filthy Cloth",weight:1,desc:"A tattered fabric looted from a feral goblin."},"goblin-dagger":{type:"weapon",name:"Goblin Dagger",weight:3,desc:"A small dagger with a serrated edge. It was once the prized possession of a goblin thief.",atk_dmg:10,atk_rate:1,size:"secondary"},"heal-salve":{type:"consumable",name:"Healing Salve",weight:2,desc:"A potent herbal blend that can disinfect and heal lesser wounds.",effect:"+20 HP",use:function(){healPlayer(20)}},"raven-feather":{type:"artifact",name:"Raven Feather",weight:1,desc:"A fancy feather dropped by a raven."},"small-pack":{type:"equipable",name:"Small Backpack",weight:8,desc:"A small pack that can be worn to increase your inventory weight cap.",section:"Back"},"tali-life":{type:"accessory",name:"Talisman of Life",weight:3,desc:"A golden artifact covered with strange inscriptions. When held, it radiates a pleasant energy.",effect:"+1 HP/s in combat"}};let inventory=[],itemLink=function(e){return`<button style="color: green" onClick="inspectItem('${e}')">${items[e].name}</button>`};function displayInventory(){let e=$("#inventory");e.empty(),e.append(addHeader("INVENTORY"));let t=0,n=!1;for(let o in inventory)e.append(`${itemLink(inventory[o])}<br>`),"small-pack"===inventory[o]&&(n=!0),t+=items[inventory[o]].weight;n&&(player.weight.max=100),player.weight.now=t,displayPlayer()}function acquireItem(e){itemObj=items[e],itemObj.weight+player.weight.now>player.weight.max||("None"===player.primary&&"weapon"===itemObj.type?player.primary=e:"None"===player.secondary&&"weapon"===itemObj.type?player.secondary=e:inventory.push(e),$("#info").append(`<span style="color: navy">Acquired</span> ${itemLink(e)}<br><br>`),displayInventory())}function discardItem(e){for(let t in inventory)if(inventory[t]===e)return inventory.splice(t,1),displayInventory(),inspectItem(e),void $("#info").append(`<span style="color: navy">Discarded</span> ${itemLink(e)}<br><br>`)}function useItem(e){let t=items.error;for(let n=0;n<Object.keys(items).length;n++)if(Object.keys(items)[n]===e){t=Object.values(items)[n];break}for(let n in inventory)if(inventory[n]===e)return t.use(),inventory.splice(n,1),displayInventory(),inspectItem(e),void $("#info").append(`<span style="color: navy">Used</span> ${itemLink(e)}<br><br>`)}function inspectItem(e){let t=items.error;for(let n=0;n<Object.keys(items).length;n++)if(Object.keys(items)[n]===e){t=Object.values(items)[n];break}let n=!1;for(let t in inventory)inventory[t]===e&&(n=!0);switch($inspect=$("#inspect"),$inspect.empty().append(addHeader("INSPECT")).append(`<p style="color: green; text-align: center; text-transform: capitalize">${t.name} (${t.type})</p>`).append(`<br>${t.desc}`).append(`<br><br>Weight: ${t.weight}`),t.type){case"weapon":$inspect.append(`<br>Attack Damage: ${t.atk_dmg}`),$inspect.append(`<br>Attack Cooldown: ${t.atk_rate.toFixed(1)}s`);break;case"accessory":$inspect.append(`<br>Effect: ${t.effect}`);break;case"consumable":$inspect.append(`<br>Effect: ${t.effect}`),n&&$inspect.append(`<br><br>${addButton(`useItem('${e}')`,"Use Item")}`);break;case"equipable":$inspect.append(`<br>Section: ${t.section}`)}n&&("consumable"!==t.type&&$inspect.append("<br><br>"),$inspect.append(`${addButton(`discardItem('${e}')`,"Discard")}`))}const enemies={"feral-goblin":{name:"Feral Goblin",health:50,atk_dmg:3,atk_rate:1,def:1,desc:"A savage goblinoid armed with nothing but its filthy claws.",drops:["filthy-cloth"]},"goblin-thief":{name:"Goblin Thief",health:50,atk_dmg:8,atk_rate:1,def:2,desc:"A small, wiry goblin wielding a sharp, durable blade.",drops:["goblin-dagger"]},"large-raven":{name:"Large Raven",health:30,atk_dmg:4,atk_rate:2,def:1,desc:"A mean looking bird with powerful talons.",drops:["raven-feather"]},nightstalker:{name:"Nightstalker",health:80,atk_dmg:15,atk_rate:2,def:3,desc:"A grotesque, batlike creature that lives and hunts in low-light environments.",drops:["heal-salve"]},error:{health:0,atk_dmg:0,atk_rate:0,def:0,desc:'That enemy could not be found. Please report this issue to <a href="https://github.com/thebitspud/age-of-ruin/issues" target="_blank" rel="noopener">the developer</a>.'}};let enemyLink=function(e){return`<button style="color: brown" onClick="inspectEnemy('${e}')">${enemies[e].name}</button>`},activeEnemy={title:"",health:0},nextEvent="";function inspectEnemy(e){let t=enemies[activeEnemy.title];$inspect=$("#inspect"),$inspect.empty().append(addHeader("INSPECT")).append(`<p style="color: brown; text-align: center">${t.name}</p>`).append(`<br>${t.desc}`).append(`<br><br>Max Health: ${t.health}`).append(`<br>Attack Damage: ${t.atk_dmg}`).append(`<br>Attack Cooldown: ${t.atk_rate.toFixed(1)}s`).append(`<br>Defense: ${t.def}`)}let enemyAttackTimer,encounterEnemy=function(e,t){return addButton(`enemyPrompt('${e}', '${t}')`,"Continue")};function enemyPrompt(e,t){nextEvent=e,activeEnemy.title=t,activeEnemy.health=enemies[t].health,$("#info").append(`<span style="color: navy">Encountered</span> ${enemyLink(activeEnemy.title)}<br><br>`),setOptions(addButton("beginCombat()","Fight")+addButton("playerFlee()","Flee"))}function inspectEnemyDrops(){$("#info").empty(),0===enemies[activeEnemy.title].drops.length&&($("#info").append(`${enemyLink(activeEnemy.title)} did not drop anything. <br><br>`),setOptions(addEventToggle(nextEvent,"Continue")));for(let e in enemies[activeEnemy.title].drops){let t=enemies[activeEnemy.title].drops[e];$("#info").append(`${enemyLink(activeEnemy.title)} <span style="color: navy">dropped</span> ${itemLink(t)}<br><br>`),setOptions(pickUpItemPrompt(nextEvent,t))}}function beginCombat(){$("#info").append('Battle started!<div id="enemy"></div>'),displayEnemy(),enemyAttackTimer=setInterval(enemyAttack,1e3*enemies[activeEnemy.title].atk_rate),$options=$("#options"),$options.empty(),"None"!==player.primary&&$options.append(addIDButton("primary","playerUsePrimary()",`Use ${items[player.primary].name}`)),"None"!==player.secondary&&$options.append(addIDButton("secondary","playerUseSecondary()",`Use ${items[player.secondary].name}`)),$options.append("<br><br>"+addButton("playerSurrender()","Surrender")+addButton("playerFlee()","Flee"))}function displayEnemy(){$enemy=$("#enemy"),enemyObj=enemies[activeEnemy.title],activeEnemy.health<=0&&combatWin(),$enemy.empty(),$enemy.append(enemyLink(activeEnemy.title)+"<br><br>").append(`Health: ${activeEnemy.health} / ${enemyObj.health}`)}function playerUsePrimary(){$("#primary").attr("disabled",!0),damageDealt=items[player.primary].atk_dmg-enemies[activeEnemy.title].def,damageDealt<1&&(damageDealt=1),activeEnemy.health-=damageDealt,displayEnemy();let e=1e3*items[player.primary].atk_rate;setTimeout(function(){$("#primary").attr("disabled",!1)},e)}function playerUseSecondary(){$("#secondary").attr("disabled",!0),damageDealt=items[player.secondary].atk_dmg-enemies[activeEnemy.title].def,damageDealt<1&&(damageDealt=1),activeEnemy.health-=damageDealt,displayEnemy();let e=1e3*items[player.secondary].atk_rate;setTimeout(function(){$("#secondary").attr("disabled",!1)},e)}function playerSurrender(){clearInterval(enemyAttackTimer),$("#info").empty().append(`${enemyLink(activeEnemy.title)} lost interest and left.<br><br>`),setOptions(addEventToggle(nextEvent,"Continue"))}function playerFlee(){clearInterval(enemyAttackTimer),$("#info").empty().append(`Player successfully fled from ${enemyLink(activeEnemy.title)}.<br><br>`),setOptions(addEventToggle(nextEvent,"Continue"))}function enemyAttack(){damageDealt=enemies[activeEnemy.title].atk_dmg-player.def,damageDealt<1&&(damageDealt=1),player.health.now-=damageDealt,player.health.now<=0&&combatLoss(),displayPlayer()}function enemySurrender(){clearInterval(enemyAttackTimer)}function enemyFlee(){clearInterval(enemyAttackTimer)}function combatWin(){activeEnemy.health=0,clearInterval(enemyAttackTimer),$("#info").append(`${enemyLink(activeEnemy.title)} has been defeated in combat.<br><br>`),setOptions(addButton("inspectEnemyDrops()","Inspect Drops"))}function combatLoss(){player.health.now=0,clearInterval(enemyAttackTimer),$("#info").empty().append("Player has died. Refresh the page to restart."),$("#options").empty()}let addEventToggle=function(e,t){return addButton(`playEvent('${e}')`,t)},pickUpItemPrompt=function(e,t){return addButton(`inspectItem('${t}')`,"Inspect")+addButton(`pickUpSuccess('${e}', '${t}')`,"Pick Up")+addButton(`pickUpDecline('${e}', '${t}')`,"Discard")},events={};function addEventPack(e){events=Object.assign(events,e)}function playEvent(e){evtObj=events[e],evtInfo=evtObj.info,$info=$("#info"),evtInfo.startsWith("-c")&&($info.empty(),evtInfo=evtInfo.substr(2)),$info.append(evtInfo+"<br><br>"),setOptions(evtObj.options)}function pickUpSuccess(e,t){setOptions(addEventToggle(e,"Continue")),acquireItem(t)}function pickUpDecline(e,t){$("#info").append(`<span style="color: navy">Discarded</span> ${itemLink(t)}<br><br>`),setOptions(addEventToggle(e,"Continue"))}const evts_intro={"intro-0":{info:"-cYou wake up and open your eyes.",options:addEventToggle("intro-1","Continue")},"intro-1":{info:"Though the ground you lie on is cold and uneven, you can't help but admire the countless stars dotting the clear night sky.",options:addEventToggle("intro-2","Continue")},"intro-2":{info:"After a while, you sit up and survey the unfamiliar landscape. It is still dark out, but the light of dawn grows brighter in the distance.",options:addEventToggle("intro-3","Continue")},"intro-3":{info:"You can tell that you are in an unkempt grassy clearing. You have no idea how you got here.",options:addEventToggle("intro-4","Continue")},"intro-4":{info:"A small, metallic object in the grass catches your eye.",options:addButton("inspectItem('blunt-dagger')","Inspect")+addButton("pickUpSuccess('intro-5', 'blunt-dagger')","Pick Up")},"intro-5":{info:"There appears to be nothing else of interest here. Moving out of this area would be a good idea. ",options:addEventToggle("intro-6","Continue")},"intro-6":{info:"Behind you is a towering forest, but in the opposite direction you spot what appears to be a well used road.",options:addEventToggle("forest-0","To the Forest")+addEventToggle("road-0","To the Road")}},evts_forest={"forest-0":{info:"-cYou cautiously approach the monumental forest, peering into the dark expanse beneath the canopy.",options:addEventToggle("forest-1","Inspect Area")},"forest-1":{info:"Along the forest edge, you spot some bright red berries growing on a shrub.",options:pickUpItemPrompt("forest-2","berries")},"forest-2":{info:"You are about to turn around and head for the road when a sudden glint of light in the undergrowth catches your eye.",options:addEventToggle("forest-3","Investigate")+addEventToggle("road-0","To the Road")},"forest-3":{info:"You warily advance towards the object that caught your attention. Upon further inspection, it appears to be some sort of coin-shaped talisman.",options:pickUpItemPrompt("forest-4","tali-life")},"forest-4":{info:"-cA giant shadow swoops in from above.",options:encounterEnemy("forest-5","large-raven")},"forest-5":{info:"There appears to be nothing else of interest here.",options:addEventToggle("road-0","To the Road")}},evts_road={"road-0":{info:"-cThe monotonous gravel of the road starkly contrasts with the wild grasses that surround it.",options:addEventToggle("w-road-0","Turn Left")+addEventToggle("e-road-0","Turn Right")},"w-road-0":{info:"You turn left.",options:addEventToggle("w-road-1","Continue")},"w-road-1":{info:"The winding road stretches on as far as you can see.",options:addEventToggle("w-road-2","Continue")},"w-road-2":{info:"While walking along the track, you notice a tall stone obelisk off in the distance.",options:addEventToggle("obelisk-0","Investigate")+addEventToggle("w-road-3","Ignore")},"w-road-3":{info:"You ignore the structure and proceed forwards.",options:addEventToggle("w-road-4","Continue")},"w-road-4":{info:"-cYou hear light footsteps approaching from behind.",options:encounterEnemy("w-road-5","feral-goblin")},"w-road-5":{info:"The road slowly tapers off into an unpaved trail leading across a mountain range.",options:addEventToggle("mountain-0","Continue Forward")+addEventToggle("e-road-0a","Turn Back")},"e-road-0":{info:"You turn right.",options:addEventToggle("e-road-1","Continue")},"e-road-0a":{info:"-cYou decide to turn around and walk back in the direction you came from. You pass by the obelisk and the clearing in which you woke up.",options:addEventToggle("e-road-1","Continue")},"e-road-0b":{info:"-cYou decide to turn around and walk back in the direction you came from. Eventually, you move back onto the road, pass by the obelisk, and cross the clearing in which you woke up.",options:addEventToggle("e-road-1","Continue")},"e-road-1":{info:"As you stroll along, you spot a figure in the distance walking in your direction.",options:addEventToggle("e-road-2","Continue")}},evts_obelisk={"obelisk-0":{info:"-cYou approach the obelisk.",options:addEventToggle("obelisk-1","Continue")},"obelisk-1":{info:"This monolith has three uniform sides and stands at roughly five times your height. The ground around it is fitted with smooth chunks of rock dotted with patches of moss.",options:addEventToggle("obelisk-2","Continue")},"obelisk-2":{info:"A barely legible script is etched into the base of the obelisk.",options:addEventToggle("obelisk-3","Read the Text")},"obelisk-3":{info:'The script reads as follows:<br><em style="color:darkblue">Place a hand upon this stone for a glimpse of coming times</em>',options:addEventToggle("vision-1","Touch it")+addEventToggle("obelisk-4","Leave")},"obelisk-4":{info:"-cYou move away from the obelisk and back onto the road.",options:addEventToggle("w-road-4","Continue")}},evts_vision={"vision-1":{info:"-cYou place your palm on the obelisk. At once, an overwhelming vision fills your mind.",options:addEventToggle("vision-2","Continue")},"vision-2":{info:"In front of you is a bird's eye view of a fortress city. The settlement is bustling with activity, particularly around the outer wall, but there is a certain unease to the scene.",options:addEventToggle("vision-3","Continue")},"vision-3":{info:"The vision shifts and refocuses. In a huge ring surrounding the city, an impossibly large army of hideous creatures has been assembled. Goblinoid and orcish warriors make up the plurality, but there are other things in there. Things that should not exist in this world.",options:addEventToggle("vision-4","Continue")},"vision-4":{info:"As one, they advance towards the city. Waves of arrows and magical projectiles rain down on the horde, but the stampede continues unhindered.",options:addEventToggle("vision-5","Continue")},"vision-5":{info:"The horde reaches the fortified perimeter, overwhelming the defenders with ease. As the outer wall collapses, countless terrors pour through and devour the city's inhabitants alive.",options:addEventToggle("vision-6","Continue")},"vision-6":{info:"Horrified, you snap out of the vision and remove your hand from the obelisk.",options:addEventToggle("obelisk-4","To the Road")}},evts_mountain={"mountain-0":{info:"-cYou follow the trail through the mountains, being careful not to stray from the path.",options:addEventToggle("mountain-1","Continue")},"mountain-1":{info:"The trail abruptly ends at a fast-flowing river. Without assistance, attempting to cross would be suicidal.",options:addEventToggle("mountain-2","Inspect Area")+addEventToggle("e-road-0b","Turn Back")},"mountain-2":{info:"You spot some red berries growing on a bush near the water.",options:pickUpItemPrompt("mountain-3","berries")},"mountain-3":{info:"There appears to be nothing else of interest here.",options:addEventToggle("e-road-0b","Turn Back")},"mountain-4":{info:"As you continue forward, you begin to suspect that someone or something is watching you.",options:addEventToggle("mountain-5","Continue")},"mountain-5":{info:"-cYou hear light footsteps approaching from behind.",options:encounterEnemy("mountain-5","goblin-thief")}};